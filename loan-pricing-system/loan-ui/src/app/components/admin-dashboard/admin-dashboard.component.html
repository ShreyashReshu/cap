<div class="container-lg py-5">
  <div class="row mb-5">
    <div class="col">
      <h2><i class="bi bi-speedometer2 me-2"></i>Admin Dashboard</h2>
      <p class="text-muted">Monitor all loan applications and approvals</p>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
    <i class="bi bi-exclamation-circle me-2"></i>{{ error }}
    <button type="button" class="btn-close" (click)="error = null"></button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-muted">Loading dashboard data...</p>
  </div>

  <div *ngIf="!loading">
    <!-- Key Metrics -->
    <div class="row g-3 mb-4">
      <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="text-muted small mb-2">Total Loans</p>
                <h3 class="mb-0">{{ stats.total }}</h3>
              </div>
              <div class="text-primary fs-3">
                <i class="bi bi-file-earmark-text"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100 bg-warning bg-opacity-10">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="text-muted small mb-2">Pending Review</p>
                <h3 class="mb-0 text-warning">{{ stats.submitted + stats.underReview }}</h3>
              </div>
              <div class="text-warning fs-3">
                <i class="bi bi-hourglass-split"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100 bg-success bg-opacity-10">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="text-muted small mb-2">Approved</p>
                <h3 class="mb-0 text-success">{{ stats.approved }}</h3>
              </div>
              <div class="text-success fs-3">
                <i class="bi bi-check-circle"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm h-100 bg-danger bg-opacity-10">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <p class="text-muted small mb-2">Rejected</p>
                <h3 class="mb-0 text-danger">{{ stats.rejected }}</h3>
              </div>
              <div class="text-danger fs-3">
                <i class="bi bi-x-circle"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loan Amount Metrics -->
    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <p class="text-muted small mb-2">Total Requested Amount</p>
            <h4 class="mb-0">{{ stats.totalAmount | currency:'INR':'symbol':'1.0-0' }}</h4>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <p class="text-muted small mb-2">Total Approved Amount</p>
            <h4 class="mb-0 text-success">{{ stats.approvedAmount | currency:'INR':'symbol':'1.0-0' }}</h4>
          </div>
        </div>
      </div>
    </div>

    <!-- Status Breakdown -->
    <div class="row mb-4">
      <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light border-bottom">
            <h5 class="mb-0"><i class="bi bi-pie-chart me-2"></i>Loan Status Breakdown</h5>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-4 pb-3 border-end">
                <div class="badge bg-secondary p-2 mb-2" style="font-size: 1rem;">{{ stats.draft }}</div>
                <p class="small text-muted mb-0">DRAFT</p>
              </div>
              <div class="col-4 pb-3 border-end">
                <div class="badge bg-info p-2 mb-2" style="font-size: 1rem;">{{ stats.submitted }}</div>
                <p class="small text-muted mb-0">SUBMITTED</p>
              </div>
              <div class="col-4 pb-3">
                <div class="badge bg-warning p-2 mb-2" style="font-size: 1rem;">{{ stats.underReview }}</div>
                <p class="small text-muted mb-0">UNDER REVIEW</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light border-bottom">
            <h5 class="mb-0"><i class="bi bi-list-check me-2"></i>Final Status</h5>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-6 pb-3 border-end">
                <div class="badge bg-success p-2 mb-2" style="font-size: 1rem;">{{ stats.approved }}</div>
                <p class="small text-muted mb-0">APPROVED</p>
              </div>
              <div class="col-6 pb-3">
                <div class="badge bg-danger p-2 mb-2" style="font-size: 1rem;">{{ stats.rejected }}</div>
                <p class="small text-muted mb-0">REJECTED</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Loans -->
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-light border-bottom">
        <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Recent Loan Applications</h5>
      </div>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Client Name</th>
              <th>Loan Type</th>
              <th>Amount</th>
              <th>Interest Rate</th>
              <th>Status</th>
              <th>Created</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let loan of recentLoans" class="align-middle">
              <td class="fw-500">{{ loan.clientName }}</td>
              <td>{{ loan.loanType }}</td>
              <td>{{ loan.requestedAmount | currency:'INR':'symbol':'1.0-0' }}</td>
              <td>{{ loan.proposedInterestRate }}%</td>
              <td>
                <span [ngClass]="'badge ' + getStatusBadgeClass(loan.status)">
                  {{ loan.status }}
                </span>
              </td>
              <td class="text-muted small">{{ loan.createdAt | date:'short' }}</td>
              <td class="text-end">
                <a [routerLink]="['/loans', loan._id || loan.id]" class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-eye"></i> View
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="card-footer bg-light">
        <small class="text-muted">
          Showing recent {{ recentLoans.length }} loans. <a href="javascript:;" class="text-decoration-none">View all loans</a>
        </small>
      </div>
    </div>
  </div>
</div>
